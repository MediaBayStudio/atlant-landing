document.addEventListener("DOMContentLoaded",function(){var t,r,s,n,i;s=id("quiz"),n=s&&id("quiz-form"),i=n&&q(".quiz__form-result",n),s&&(window.Quiz=(Quiz=function(e,t){var s=this;return s.assign=function(e,t){for(var r in e)void 0===t[r]?t[r]=e[r]:"object"==typeof t[r]&&s.assign(e[r],t[r])},s.createEl=function(e){return document.createElement(e)},s.q=function(e,t){return(t=t||document).querySelector(e)},s.$quiz="string"==typeof e?s.q(e):e,"string"==typeof t.$form?s.$form=s.q(t.$form):s.$form=t.$form,"string"==typeof t.$result?s.$result=s.q(t.$result):s.$result=t.$result,s.options=t||{},s.defaults={headerTag:"div",bodyTag:"div",footerTag:"div",stepTitletag:"span",fieldTag:"label",fieldTitleTag:"span",prevBtnTag:"button",nextBtnTag:"button",dotsTag:"div",dotTag:"div",stepsCounterNumTag:"div",currentStepNumTag:"span",totalStepNumTag:"span",dots:!1,counter:!1,prev:!0,next:!0,headerClass:"quiz__header",bodyClass:"quiz__body",footerClass:"quiz__footer",stepTittleClass:"quiz__step-title",prevBtnClass:"quiz__prev",nextBtnClass:"quiz__next",dotsClass:"quiz__dots",dotClass:"quiz__dot",stepsCounterNumClass:"quiz__steps-counter",currentStepNumClass:"quiz__current-steps-number",totalStepNumClass:"quiz__total-steps-number",gropupInputsClass:"quiz__group-inputs",groupInputsTitleClass:"quiz__group-title",prevBtnText:"Назад",nextBtnText:"Следующий шаг",fieldClasses:{radio:"quiz__radio",checkbox:"quiz__checkbox",text:"quiz__text",textarea:"quiz__text",select:"quiz__select"}},s.$dots=[],s.$steps=[],s.$filledSteps=[],s.radioCount=0,s.checkboxCount=0,s.assign(s.defaults,s.options),s.stepsLength=t.steps.length+1,s.currentStep=0,s.inputHandler=s.input.bind(s),s.nextStepHandler=s.nextStep.bind(s),s.prevStepHandler=s.prevStep.bind(s),s.init(),s.$prevStep=s.$steps[s.currentStep-1],s.$currentStep=s.$steps[s.currentStep],s.$nextStep=s.$steps[s.currentStep+1],s.$filledFieldsOnThisStep=[],s.$fieldsOnThisStep=null,s.result=[],s.printStep(s.currentStep),s.$quiz.resetQuiz=s.resetQuiz,s.dispatchEvent(s.$quiz,"init",s.setEventDetails()),s.$quiz},Quiz.prototype.init=function(){var e=this;e.options;e.$form.parentElement.style.display="none",(e.$quiz.quiz=e).buildInsides(),e.buildSteps(),e.$steps.push(e.$form),e.$next.classList.add("disabled"),e.$prev.classList.add("disabled"),e.$dots[e.currentStep].classList.add("active"),e.$quiz.addEventListener("input",e.inputHandler)},Quiz.prototype.dispatchEvent=function(e,t,r){"function"==typeof window.CustomEvent&&(r=r||{},r=new CustomEvent(t,r),e.dispatchEvent(r))},Quiz.prototype.buildInsides=function(){function e(e,t){"button"===e&&t.setAttribute("type","button")}var t=this,r=t.options;if(t.$header=t.createEl(r.headerTag),t.$body=t.createEl(r.bodyTag),t.$footer=t.createEl(r.footerTag),t.$stepsTitle=t.createEl(r.stepTitletag),t.$header.className=r.headerClass,t.$body.className=r.bodyClass,t.$footer.className=r.footerClass,t.$stepsTitle.className=r.stepTittleClass,r.counter&&(t.$stepsCounter=t.createEl(r.stepsCounterNumTag),t.$counterCurrentNum=t.createEl(r.currentStepNumTag),t.$counterTotalNum=t.createEl(r.totalStepNumTag),t.$stepsCounter.className=r.stepsCounterNumClass,t.$counterCurrentNum.className=r.currentStepNumClass,t.$counterTotalNum.className=r.totalStepNumClass,t.$counterCurrentNum.textContent=t.currentStep+1,t.$counterTotalNum.textContent=t.stepsLength,t.$stepsCounter.innerHTML="<span>Шаг</span> ",t.$stepsCounter.appendChild(t.$counterCurrentNum),t.$stepsCounter.insertAdjacentHTML("beforeend"," <span>из</span> "),t.$stepsCounter.appendChild(t.$counterTotalNum)),r.dots){t.$dotsBlock=t.createEl(r.dotsTag),t.$dotsBlock.className=r.dotsClass;for(var s=0;s<t.stepsLength;s++){var n=t.createEl(r.dotTag);n.className=r.dotClass,e(r.dotTag,n),t.$dots[s]=n,t.$dotsBlock.appendChild(n)}}r.prev&&(t.$prev=t.createEl(r.prevBtnTag),t.$prev.className=r.prevBtnClass,e(r.prevBtnTag,t.$prev),t.$prev.textContent=r.prevBtnText),r.next&&(t.$next=t.createEl(r.nextBtnTag),t.$next.className=r.nextBtnClass,e(r.nextBtnTag,t.$next),t.$next.textContent=r.nextBtnText),t.$header.appendChild(t.$stepsCounter),t.$header.appendChild(t.$dotsBlock),t.$header.appendChild(t.$stepsTitle),t.$footer.appendChild(t.$prev),t.$footer.appendChild(t.$next),t.$quiz.appendChild(t.$header),t.$quiz.appendChild(t.$body),t.$quiz.appendChild(t.$footer)},Quiz.prototype.setEventDetails=function(){var e=this;return{detail:{prevStep:e.currentStep-1,currentStep:e.currentStep,nextStep:e.currentStep+1,stepsLength:e.stepsLength,currentStepObject:e.$currentStep,quizObject:e}}},Quiz.prototype.buildSteps=function(){var e,t=this,r=t.options.steps;for(e in r){var s=r[e],n=s.fields,i=s.options,a=s.extrafields,p={};if(n){var l=s["step-title"],n=t.parseFields(n),a=a&&t.parseExtraFields(a);p["step-title"]=l,p.fields=n.fieldsArray,p.extrafields=a,p.html=n.html,p.options=i}else for(var o in s){var d=t.parseFields(s[o].fields),u=s[o].extrafields,c=s[o]["step-title"],$=s[o].options,u=u&&t.parseExtraFields(u);p[o]={options:$,"step-title":c,fields:d.fieldsArray,extrafields:u,html:d.html}}t.$steps.push(p)}},Quiz.prototype.parseFields=function(e,t){var r,s=this,n=s.options,i={fieldsArray:[],html:[]};for(r in e){var a=e[r],p=a.type,l=a["group-title"],o=a.title,d=a.required,u=a.values,c=a.placeholder,$="textarea"===p?"textarea":"input",f=n.fieldClasses[p],v=p;if("text"===p||"number"===p||"textarea"===p){var h=s.createEl(n.fieldTag),S=s.createEl(n.fieldTitleTag),m=s.createEl($),a="textarea"===p?"-textarea":"-inp",x={};t&&h.setAttribute("data-extra-field",""),m.type=p,c&&(m.placeholder=c),S.textContent=o,S.setAttribute("data-field-title",""),h.className=f,m.className=f+a+(d?" required":""),S.className=f+"-title",h.appendChild(S),h.appendChild(m),x.input=m,x.field=h,x.title=S,i.fieldsArray.push(x),i.html.push(h)}else if(u&&0<u.length){var C=void 0,S=void 0,g=void 0,x=void 0,h=void 0;l&&(C=s.createEl("div"),S=s.createEl("span"),C.className=n.gropupInputsClass,S.className=n.groupInputsTitleClass,S.textContent=l,S.setAttribute("data-field-title",""),C.appendChild(S)),"select"===p&&(x=s.createEl(n.fieldTag),g=s.createEl("select"),h=s.createEl(n.fieldTitleTag),x.appendChild(h),x.appendChild(g),h.className=f+"-title",h.textContent=o,h.setAttribute("data-field-title",""),x.className=f,g.className=f+"-inp"+(d?" required":""));for(var T=0,b=u.length;T<b;T++){var z=void 0,q=void 0,E=void 0,y=void 0,N=void 0,L={};"select"===p?((E=s.createEl("option")).value=E.textContent=u[T],z=g):(z=s.createEl(n.fieldTag),q=s.createEl(n.fieldTitleTag),E=s.createEl($),y=s.createEl("span"),N="radio"===p?"radio-"+s.radioCount:"checkbox-"+s.checkboxCount,E.value=u[T],E.name=N,E.type=p,q.textContent=u[T],y.className=f+"-pseudo-inp",z.className=f,E.className=f+"-inp"+(d?" required":"")),q&&(q.className=f+"-title",L.title=q),L.input=E,(L.field=z).appendChild(E),y&&z.appendChild(y),q&&z.appendChild(q),C&&"select"!==p&&C.appendChild(z),i.fieldsArray.push(L)}C?(x&&C.appendChild(x),i.html.push(C)):x&&i.html.push(x)}}return"radio"===v&&s.radioCount++,"checkbox"===v&&s.checkboxCount++,i},Quiz.prototype.parseExtraFields=function(e){var t,r={};for(t in e){var s=e[t],s=this.parseFields(s,!0);r[t]=s}return r},Quiz.prototype.clearPrevStep=function(){var e=this,t=e.$body,r=e.$prevStep;if(formParent=e.$form.parentElement,r)if(r===e.$form)formParent.style.display="none",e.$quiz.replaceChild(t,formParent),e.$result.value="";else{for(var s=r.html,n=r.extrafields,i=0,a=s.length;i<a;i++)t.removeChild(s[i]);if(n)for(var p in n)for(var l=n[p].html,o=0,d=l.length;o<d;o++)t.contains(l[o])&&t.removeChild(l[o])}},Quiz.prototype.printStep=function(e){var t,r=this,s=(r.options,r.$body),n=r.$prevStep,i=r.$currentStep.html,a=n&&n.value;if(formParent=r.$form.parentElement,r.$currentStep!==r.$form){if(!i){if(a)for(var p in a){var l=a[p],o=!1;if(1===l.length){if(r.$currentStep[l=""+l]){t=l;break}for(var d in r.$currentStep)if(-1!==d.indexOf(l)){t=d,o=!0;break}}else for(var u=0,c=l.length;u<c;u++){for(var $ in r.$currentStep)if(-1!==$.indexOf(l[u])){t=$,o=!0;break}if(o)break}if(o)break}t&&(r.$currentStep=r.$currentStep[t],i=r.$currentStep.html)}for(var f in r.clearPrevStep(),i){f=i[f];s.appendChild(f)}r.$stepsTitle.textContent=r.$currentStep["step-title"],r.$fieldsOnThisStep=qa("select, input, textarea",s,!0);for(var v=r.$fieldsOnThisStep.length-1;0<=v;v--){var h=r.$fieldsOnThisStep[v],S=h.type;h.checked&&(h.checked=!1),"text"!==S&&"textarea"!==S&&"number"!==S||(h.value=""),"SELECT"===h.tagName&&(h.selectedIndex=0)}}else{formParent.style.display="block",r.$quiz.replaceChild(formParent,s),r.$quiz.classList.add("final-step");for(var m=0,x=r.result.length;m<x;m++){var C,g=r.result[m];for(C in g){var T=g[C].join(", ");r.$result.value+=C+": "+T+"\n"}}r.clearPrevStep()}},Quiz.prototype.input=function(){for(var i=this,a=i.$currentStep.extrafields,p=[],l=[],o=[],d=[],u=[],c=[],$=[],e=!0,t=!0,r=i.$fieldsOnThisStep.length-1;0<=r;r--)(function(e){var t=i.$fieldsOnThisStep[e],r=t.type,s=t.value,e=t.tagName,n=t.checked;if("radio"===r?(p[p.length]=t,a&&a[s]&&a[s].html.forEach(function(e){var t=i.$body.contains(e),r=q("input",e);n?t||(r.value="",i.$body.appendChild(e),i.$fieldsOnThisStep.push(r),r.classList.contains("required")&&d.push(r)):t&&(r.value="",i.$body.removeChild(e),t=i.$fieldsOnThisStep.indexOf(r),e=d.indexOf(r),r=c.indexOf(r),-1!==t&&i.$fieldsOnThisStep.splice(t,1),-1!==e&&d.splice(e,1),-1!==r&&c.splice(r,1))})):"checkbox"===r?l[l.length]=t:"select"===e&&(o[o.length]=t),t.classList.contains("required")&&(d[d.length]=t,""===s?u[u.length]=t:c[c.length]=t),""!==s){if(("radio"===r||"checkbox"===r)&&!n)return;$[$.length]=t}})(r);0<p.length&&(e=p.some(function(e){return e.checked})),0<l.length&&(t=l.some(function(e){return e.checked})),d.length===c.length&&e&&t?(i.$next.classList.remove("disabled"),i.$next.addEventListener("click",i.nextStepHandler)):(i.$next.classList.add("disabled"),i.$next.removeEventListener("click",i.nextStepHandler)),i.$filledFieldsOnThisStep=$},Quiz.prototype.nextStep=function(){for(var e=this,t=e.options,r={},s=e.$filledFieldsOnThisStep,n=0,i=s.length;n<i;n++){var a=s[n],p=a.type,p=("radio"===p||"checkbox"===p?a.parentElement:a).parentElement,p=q("[data-field-title]",p).textContent;void 0===r[p]&&(r[p]=[]),r[p].push(a.value)}if(e.result[e.result.length]=r,e.$prevStep=e.$currentStep,e.$prevStep.value=r,e.currentStep++,e.$currentStep=e.$steps[e.currentStep],e.$nextStep=e.$steps[e.currentStep+1],e.printStep(e.currentStep),t.prev&&0<e.currentStep&&(e.$prev.classList.remove("disabled"),e.$prev.addEventListener("click",e.prevStepHandler)),t.next){for(var l=!1,o=0,d=e.$fieldsOnThisStep.length;o<d;o++)if(e.$fieldsOnThisStep[o].classList.contains("required")){l=!0;break}l?(e.$next.classList.add("disabled"),e.$next.removeEventListener("click",e.nextStepHandler)):e.input()}t.dots&&(e.$dots[e.currentStep-1].classList.remove("active"),e.$dots[e.currentStep].classList.add("active")),t.counter&&(e.$counterCurrentNum.textContent=e.currentStep+1),e.$filledSteps.push(e.$prevStep),e.dispatchEvent(e.$quiz,"nextstep",e.setEventDetails())},Quiz.prototype.prevStep=function(){var e=this,t=e.options;if(e.$prevStep=e.$currentStep,e.currentStep--,e.$currentStep=e.$filledSteps[e.currentStep],e.$nextStep=e.$filledSteps[e.currentStep-1],e.result.pop(),e.printStep(e.currentStep),t.prev&&(e.$prev.classList.toggle("disabled",0===e.currentStep),0===e.currentStep&&e.$prev.removeEventListener("click",e.prevStepHandler)),t.next){for(var r=!1,s=0,n=e.$fieldsOnThisStep.length;s<n;s++)if(e.$fieldsOnThisStep[s].classList.contains("required")){r=!0;break}r?(e.$next.classList.add("disabled"),e.$next.removeEventListener("click",e.nextStepHandler)):(e.$next.classList.remove("disabled"),e.$next.addEventListener("click",e.nextStepHandler))}t.dots&&(e.$dots[e.currentStep].classList.add("active"),e.$dots[e.currentStep+1].classList.remove("active")),t.counter&&(e.$counterCurrentNum.textContent=e.currentStep+1),e.$quiz.classList.remove("final-step"),e.$filledSteps.pop(),e.dispatchEvent(e.$quiz,"prevstep",e.setEventDetails())},Quiz.prototype.resetQuiz=function(){var e=this.quiz;if(e.$prevStep=e.$currentStep,e.currentStep=0,e.$currentStep=e.$steps[e.currentStep],e.$nextStep=e.$steps[e.currentStep+1],e.$filledSteps=[],e.$filledFieldsOnThisStep=[],e.$fieldsOnThisStep=null,e.result=[],e.$quiz.classList.remove("final-step"),e.$prev.classList.add("disabled"),e.$next.classList.add("disabled"),e.printStep(e.currentStep),e.$stepsTitle.textContent=e.$currentStep["step-title"],e.options.counter&&(e.$counterCurrentNum.textContent=e.currentStep+1),e.options.dots){for(var t=0,r=e.$dots.length;t<r;t++)e.$dots[t].classList.remove("active");e.$dots[e.currentStep].classList.add("active")}},Quiz),t=new XMLHttpRequest,templateDirectoryUri,r=function(e){e.detail.currentStepObject.options},t.open("post",templateDirectoryUri+"/quiz-kredit-pod-zalog.json"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(),s.addEventListener("init",function(e){r(e)}),s.addEventListener("nextstep",function(e){r(e),scrollToTarget(e,s)}),s.addEventListener("prevstep",function(e){r(e),scrollToTarget(e,s)}),t.addEventListener("readystatechange",function(){var e;4===t.readyState&&200===t.status&&(e=JSON.parse(t.response),new Quiz(s,{steps:e,dots:!0,counter:!0,nextBtnClass:"quiz__next btn btn_blue",nextBtnText:"Дальше",$form:n,$result:i}))})),thanksPopup=new Popup("#thanks-popup",{closeButtons:".thanks-popup__close"})});